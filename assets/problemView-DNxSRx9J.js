const F="calculated_data/problem.json";function z(){return typeof window>"u"||!window.location?F:new URL(F,window.location.href).toString()}async function G(e){const t=z(),n=await fetch(t,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`Failed to load problem: ${n.status}`);return n.json()}function D(e){if(!e||typeof e!="object")return[];const t=e.price_in_constant_usd;return!t||typeof t!="object"?[]:Object.keys(t).sort()}function I(e){if(!e||typeof e!="object")return{};const t=e.symbol_descriptions;return!t||typeof t!="object"?{}:{...t}}function b(e){return typeof e=="number"&&Number.isFinite(e)}function V(e,t){const n=Array.isArray(e==null?void 0:e.days)?e.days:[];if(!Array.isArray(t)||t.length===0||n.length===0)return null;const r=(e==null?void 0:e.price_in_constant_usd)??{};let i=0,s=n.length-1;for(const o of t){const d=Array.isArray(r[o])?r[o]:null;if(!d||d.length!==n.length)return null;let u=-1,f=-1;for(let a=0;a<d.length;a+=1)if(b(d[a])){u=a;break}for(let a=d.length-1;a>=0;a-=1)if(b(d[a])){f=a;break}if(u===-1||f===-1||u>f)return null;for(let a=u;a<=f;a+=1)if(!b(d[a]))return null;if(i=Math.max(i,u),s=Math.min(s,f),i>s)return null}return{startIndex:i,endIndex:s}}function P(e,t){var i;const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=Array.isArray((i=e==null?void 0:e.price_in_constant_usd)==null?void 0:i[t])?e.price_in_constant_usd[t]:null;if(!r||r.length!==n.length)return null;for(let s=0;s<r.length;s+=1)if(b(r[s]))return n[s];return null}function H(e,t){if(!Array.isArray(e))return[];const n=new Set(t),r=[],i=new Set;return e.forEach(s=>{!n.has(s)||i.has(s)||(r.push(s),i.add(s))}),r}function v(e,t={}){const{cutoff:n="2006-01-01",orderedTickers:r}=t,i=Array.isArray(r)&&r.length>0?r:D(e),s=i.filter(o=>{const d=P(e,o);return typeof d=="string"&&d<n});return s.length>0?[...s]:[...i]}function O(e,t={}){const{selectedTickers:n,onSelectionChange:r}=t,i=D(e),s=I(e);if(i.length===0){const c=document.createElement("p");return c.textContent="No tickers available.",c}const o=document.createElement("table");o.className="ticker-table",o.style.marginTop="12px",o.style.borderCollapse="collapse",o.style.minWidth="480px",o.style.maxWidth="960px",o.style.border="1px solid #cbd5e1";const d=document.createElement("tr");["Selected","Ticker","Description","Data since"].forEach((c,y)=>{const l=document.createElement("th");l.scope="col",l.textContent=c,l.style.textAlign="left",l.style.padding="6px 10px",l.style.borderBottom="1px solid #cbd5e1",l.style.borderRight=y<3?"1px solid #cbd5e1":"none",l.style.whiteSpace="nowrap",d.appendChild(l)});const u=document.createElement("thead");u.appendChild(d),o.appendChild(u);const f=document.createElement("tbody"),a=i.map(c=>({ticker:c,description:s[c],dataSince:P(e,c)})).sort((c,y)=>{const l=c.dataSince??"",C=y.dataSince??"";return!l&&!C?c.ticker.localeCompare(y.ticker):l?C?l===C?c.ticker.localeCompare(y.ticker):l.localeCompare(C):-1:1}),h=a.map(c=>c.ticker),S=v(e,{orderedTickers:h,cutoff:"2006-01-01"}),_=H(n,h),N=_.length>0?_:[...S],p=new Set(N);console.debug("[problemView] initial selection",N);const R=()=>{typeof r=="function"&&r(Array.from(p))},L=[],j=c=>{p.clear(),a.forEach((y,l)=>{l<=c&&p.add(y.ticker)}),L.forEach((y,l)=>{y.checked=l<=c}),R()};return a.forEach(({ticker:c,description:y,dataSince:l},C)=>{const k=document.createElement("tr"),w=document.createElement("td");w.style.padding="6px 10px",w.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",w.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",w.style.textAlign="center";const m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="center",m.style.gap="0.35rem";const g=document.createElement("input");g.type="checkbox",g.checked=p.has(c),g.dataset.ticker=c,L.push(g),g.addEventListener("change",()=>{g.checked?p.add(c):p.delete(c),console.debug("[problemView] checkbox toggled",{ticker:c,checked:g.checked,selection:Array.from(p)}),R()}),m.appendChild(g);const x=document.createElement("button");x.type="button",x.textContent="Select up to",x.style.fontSize="0.75rem",x.style.padding="2px 6px",x.style.whiteSpace="nowrap",x.addEventListener("click",()=>{j(C)}),m.appendChild(x),w.appendChild(m),k.appendChild(w);const E=document.createElement("td");E.textContent=c,E.style.padding="6px 10px",E.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",E.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",E.style.textAlign="left",k.appendChild(E);const A=document.createElement("td");A.textContent=typeof y=="string"&&y.trim()?y.trim():"—",A.style.padding="6px 10px",A.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",A.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",A.style.textAlign="left",k.appendChild(A);const T=document.createElement("td");T.textContent=l??"—",T.style.padding="6px 10px",T.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",T.style.textAlign="left",T.style.whiteSpace="nowrap",k.appendChild(T),f.appendChild(k)}),o.appendChild(f),o}function q(e,t,n={}){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const{onSelectionChange:r,selectedTickers:i}=n;if(e.innerHTML="",!t)return e.appendChild(document.createTextNode("No problem data available.")),e;const s=document.createElement("h2");s.textContent="Problem Overview";const o=document.createElement("ul"),d=document.createElement("li"),u=Array.isArray(t.days)?t.days.length:0;d.textContent=`Days covered: ${u}`;const f=document.createElement("li");f.textContent=`Constant USD day: ${t.constant_usd_day??"n/a"}`;const a=document.createElement("li");a.textContent=`Constant EUR day: ${t.constant_eur_day??"n/a"}`,o.append(d,f,a),e.append(s,o);const h=O(t,{selectedTickers:i,onSelectionChange:r});return e.appendChild(h),e}function B(e){if(!Array.isArray(e)||e.length===0)return[];const t=Number(e[0]);return!Number.isFinite(t)||t===0?e.map(()=>Number.NaN):e.map(n=>{const r=Number(n);return Number.isFinite(r)?r/t:Number.NaN})}function U(e,t={}){const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=(e==null?void 0:e.price_in_constant_usd)??{},i=Array.isArray(t.tickers)&&t.tickers.length>0?t.tickers:D(e);if(!n.length||!i.length)return[];const s=Math.max(0,Math.min(t.startIndex??0,n.length-1)),o=Math.max(s,Math.min(t.endIndex??n.length-1,n.length-1)),d=n.slice(s,o+1),u=I(e),f=[];for(const a of i){const h=Array.isArray(r[a])?r[a]:[];if(h.length===0||n.length!==h.length)continue;const M=h.slice(s,o+1);if(M.some(N=>!b(N)))continue;const S=u[a],_=typeof S=="string"&&S.trim()?`${a}: ${S.trim()}`:a;f.push({name:a,x:d,y:B(M),type:"scatter",mode:"lines",hovertemplate:"<b>%{x}</b><br />growth: %{y:.2f}x<extra>"+_+"</extra>"})}return f}function $(e,t){var r;if(!e||!((r=t==null?void 0:t.Plots)!=null&&r.resize))return;const n=()=>{try{t.Plots.resize(e)}catch{}};typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,0)}function W(e,t,n={},r=globalThis.Plotly){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const i=U(t,n);if(!r||i.length===0){e.innerHTML="";const u=typeof n.emptyMessage=="string"&&n.emptyMessage.trim()?n.emptyMessage.trim():"Chart unavailable.";return e.append(document.createTextNode(u)),null}const s={title:"$1 Constant-Dollar Growth",yaxis:{title:"Growth factor (x)",rangemode:"tozero"},xaxis:{title:"Date"},legend:{orientation:"v",x:1.02,xanchor:"left",y:1,valign:"top"},margin:{t:50,r:160,b:50,l:50}},o={responsive:!0},d=r.react(e,i,s,o);return $(e,r),d}export{V as a,v as b,q as c,I as d,O as e,G as f,D as g,W as r};
