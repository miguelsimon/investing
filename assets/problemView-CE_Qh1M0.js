const R="calculated_data/problem.json",L="problem.json";function z(){return typeof window>"u"||!window.location?R:new URL(R,window.location.href).toString()}function F(){return typeof window>"u"||!window.location?L:new URL(L,window.location.href).toString()}async function V(e){const t=[];t.push(z(),F());let n=null;for(const r of t)try{const o=await fetch(r,{headers:{Accept:"application/json"}});if(!o.ok){n=new Error(`Failed to load problem: ${o.status}`);continue}return o.json()}catch(o){n=o}throw n??new Error("Failed to load problem data.")}function D(e){if(!e||typeof e!="object")return[];const t=e.price_in_constant_usd;return!t||typeof t!="object"?[]:Object.keys(t).sort()}function P(e){if(!e||typeof e!="object")return{};const t=e.symbol_descriptions;return!t||typeof t!="object"?{}:{...t}}function _(e){return typeof e=="number"&&Number.isFinite(e)}function G(e,t){const n=Array.isArray(e==null?void 0:e.days)?e.days:[];if(!Array.isArray(t)||t.length===0||n.length===0)return null;const r=(e==null?void 0:e.price_in_constant_usd)??{};let o=0,a=n.length-1;for(const c of t){const d=Array.isArray(r[c])?r[c]:null;if(!d||d.length!==n.length)return null;let u=-1,y=-1;for(let s=0;s<d.length;s+=1)if(_(d[s])){u=s;break}for(let s=d.length-1;s>=0;s-=1)if(_(d[s])){y=s;break}if(u===-1||y===-1||u>y)return null;for(let s=u;s<=y;s+=1)if(!_(d[s]))return null;if(o=Math.max(o,u),a=Math.min(a,y),o>a)return null}return{startIndex:o,endIndex:a}}function v(e,t){var o;const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=Array.isArray((o=e==null?void 0:e.price_in_constant_usd)==null?void 0:o[t])?e.price_in_constant_usd[t]:null;if(!r||r.length!==n.length)return null;for(let a=0;a<r.length;a+=1)if(_(r[a]))return n[a];return null}function H(e,t){if(!Array.isArray(e))return[];const n=new Set(t),r=[],o=new Set;return e.forEach(a=>{!n.has(a)||o.has(a)||(r.push(a),o.add(a))}),r}function I(e,t={}){const{selectedTickers:n,onSelectionChange:r}=t,o=D(e),a=P(e);if(o.length===0){const i=document.createElement("p");return i.textContent="No tickers available.",i}const c=document.createElement("table");c.className="ticker-table",c.style.marginTop="12px",c.style.borderCollapse="collapse",c.style.minWidth="480px",c.style.maxWidth="960px",c.style.border="1px solid #cbd5e1";const d=document.createElement("tr");["Selected","Ticker","Description","Data since"].forEach((i,f)=>{const l=document.createElement("th");l.scope="col",l.textContent=i,l.style.textAlign="left",l.style.padding="6px 10px",l.style.borderBottom="1px solid #cbd5e1",l.style.borderRight=f<3?"1px solid #cbd5e1":"none",l.style.whiteSpace="nowrap",d.appendChild(l)});const u=document.createElement("thead");u.appendChild(d),c.appendChild(u);const y=document.createElement("tbody"),s=o.map(i=>({ticker:i,description:a[i],dataSince:v(e,i)})).sort((i,f)=>{const l=i.dataSince??"",E=f.dataSince??"";return!l&&!E?i.ticker.localeCompare(f.ticker):l?E?l===E?i.ticker.localeCompare(f.ticker):l.localeCompare(E):-1:1}),p=s.map(i=>i.ticker),k=H(n,p),w=k.length>0?k:[...p],h=new Set(w);console.debug("[problemView] initial selection",w);const N=()=>{typeof r=="function"&&r(Array.from(h))},M=[],j=i=>{h.clear(),s.forEach((f,l)=>{l<=i&&h.add(f.ticker)}),M.forEach((f,l)=>{f.checked=l<=i}),N()};return s.forEach(({ticker:i,description:f,dataSince:l},E)=>{const S=document.createElement("tr"),C=document.createElement("td");C.style.padding="6px 10px",C.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",C.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",C.style.textAlign="center";const g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.gap="0.35rem";const m=document.createElement("input");m.type="checkbox",m.checked=h.has(i),m.dataset.ticker=i,M.push(m),m.addEventListener("change",()=>{m.checked?h.add(i):h.delete(i),console.debug("[problemView] checkbox toggled",{ticker:i,checked:m.checked,selection:Array.from(h)}),N()}),g.appendChild(m);const x=document.createElement("button");x.type="button",x.textContent="Select up to",x.style.fontSize="0.75rem",x.style.padding="2px 6px",x.style.whiteSpace="nowrap",x.addEventListener("click",()=>{j(E)}),g.appendChild(x),C.appendChild(g),S.appendChild(C);const A=document.createElement("td");A.textContent=i,A.style.padding="6px 10px",A.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",A.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",A.style.textAlign="left",S.appendChild(A);const b=document.createElement("td");b.textContent=typeof f=="string"&&f.trim()?f.trim():"—",b.style.padding="6px 10px",b.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",b.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",b.style.textAlign="left",S.appendChild(b);const T=document.createElement("td");T.textContent=l??"—",T.style.padding="6px 10px",T.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",T.style.textAlign="left",T.style.whiteSpace="nowrap",S.appendChild(T),y.appendChild(S)}),c.appendChild(y),c}function q(e,t,n={}){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const{onSelectionChange:r,selectedTickers:o}=n;if(e.innerHTML="",!t)return e.appendChild(document.createTextNode("No problem data available.")),e;const a=document.createElement("h2");a.textContent="Problem Overview";const c=document.createElement("ul"),d=document.createElement("li"),u=Array.isArray(t.days)?t.days.length:0;d.textContent=`Days covered: ${u}`;const y=document.createElement("li");y.textContent=`Constant USD day: ${t.constant_usd_day??"n/a"}`;const s=document.createElement("li");s.textContent=`Constant EUR day: ${t.constant_eur_day??"n/a"}`,c.append(d,y,s),e.append(a,c);const p=I(t,{selectedTickers:o,onSelectionChange:r});return e.appendChild(p),e}function B(e){if(!Array.isArray(e)||e.length===0)return[];const t=Number(e[0]);return!Number.isFinite(t)||t===0?e.map(()=>Number.NaN):e.map(n=>{const r=Number(n);return Number.isFinite(r)?r/t:Number.NaN})}function U(e,t={}){const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=(e==null?void 0:e.price_in_constant_usd)??{},o=Array.isArray(t.tickers)&&t.tickers.length>0?t.tickers:D(e);if(!n.length||!o.length)return[];const a=Math.max(0,Math.min(t.startIndex??0,n.length-1)),c=Math.max(a,Math.min(t.endIndex??n.length-1,n.length-1)),d=n.slice(a,c+1),u=P(e),y=[];for(const s of o){const p=Array.isArray(r[s])?r[s]:[];if(p.length===0||n.length!==p.length)continue;const k=p.slice(a,c+1);if(k.some(N=>!_(N)))continue;const w=u[s],h=typeof w=="string"&&w.trim()?`${s}: ${w.trim()}`:s;y.push({name:s,x:d,y:B(k),type:"scatter",mode:"lines",hovertemplate:"<b>%{x}</b><br />growth: %{y:.2f}x<extra>"+h+"</extra>"})}return y}function $(e,t){var r;if(!e||!((r=t==null?void 0:t.Plots)!=null&&r.resize))return;const n=()=>{try{t.Plots.resize(e)}catch{}};typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,0)}function O(e,t,n={},r=globalThis.Plotly){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const o=U(t,n);if(!r||o.length===0){e.innerHTML="";const u=typeof n.emptyMessage=="string"&&n.emptyMessage.trim()?n.emptyMessage.trim():"Chart unavailable.";return e.append(document.createTextNode(u)),null}const a={title:"$1 Constant-Dollar Growth",yaxis:{title:"Growth factor (x)",rangemode:"tozero"},xaxis:{title:"Date"},legend:{orientation:"v",x:1.02,xanchor:"left",y:1,valign:"top"},margin:{t:50,r:160,b:50,l:50}},c={responsive:!0},d=r.react(e,o,a,c);return $(e,r),d}export{G as a,q as b,P as c,I as d,V as f,D as g,O as r};
