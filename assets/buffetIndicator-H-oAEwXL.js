import{i as p}from"./navigation-CXrC8Ner.js";const f=document.getElementById("status"),y=document.getElementById("buffet-chart-section"),x=document.getElementById("buffet-chart"),g="calculated_data/us_gdp_and_market_cap.csv",_="us_gdp_and_market_cap.csv";async function w(a){let t=null;for(const r of a)try{const s=await fetch(r,{headers:{Accept:"text/csv"}});if(!s.ok){t=new Error(`Failed to load ${r}: ${s.status}`);continue}return await s.text()}catch(s){t=s}throw t??new Error("Unable to load Buffett indicator dataset.")}function v(a){const t=(a??"").trim();if(!t)return[];const r=t.split(/\r?\n/).filter(n=>n.trim().length>0);if(r.length===0)return[];const s=r[0].split(",").map(n=>n.trim());function d(n){const e=[];let o="",c=!1;for(let i=0;i<n.length;i+=1){const l=n[i];l==='"'?c&&n[i+1]==='"'?(o+='"',i+=1):c=!c:l===","&&!c?(e.push(o),o=""):o+=l}return e.push(o),e}const u=[];for(let n=1;n<r.length;n+=1){const e=d(r[n]);if(e.length===1&&e[0].trim()==="")continue;const o={};s.forEach((c,i)=>{const l=e[i]??"";o[c]=l.trim()}),u.push(o)}return u}function h(a){const t=Number(a);return Number.isFinite(t)?t:null}function b(a){const t=[],r=[],s=[],d=[];if(a.forEach(e=>{const o=e.time??e.Time??e.TIME,c=h(e.gdp_constant_2017_usd),i=h(e.market_cap_2017_usd),l=h(e.buffet_indicator);!o||c===null||i===null||l===null||(t.push(o),r.push(c),s.push(i),d.push(l))}),t.length===0)throw new Error("Dataset did not contain any usable rows.");const u=[{name:"Buffett Indicator",x:t,y:d,type:"scatter",mode:"lines",line:{color:"#0ea5e9",width:2},yaxis:"y",hovertemplate:"%{x}<br>Indicator: %{y:.2f}<extra></extra>"},{name:"Market Cap (2017 USD)",x:t,y:s,type:"scatter",mode:"lines",line:{color:"#f97316",width:2,dash:"dash"},opacity:.7,yaxis:"y2",hovertemplate:"%{x}<br>Market Cap: %{y:$,.0f}<extra></extra>"},{name:"GDP (2017 USD)",x:t,y:r,type:"scatter",mode:"lines",line:{color:"#22c55e",width:2,dash:"dot"},opacity:.7,yaxis:"y2",hovertemplate:"%{x}<br>GDP: %{y:$,.0f}<extra></extra>"}],n={margin:{t:32,r:40,b:40,l:60},hovermode:"x unified",xaxis:{title:"Month",type:"date",showgrid:!1},yaxis:{title:"Buffett Indicator (Market Cap / GDP)",rangemode:"tozero",tickformat:".2f"},yaxis2:{title:"Chained 2017 USD",overlaying:"y",side:"right",tickformat:"$,.0f",showgrid:!1},legend:{orientation:"h",yanchor:"bottom",y:1.02,xanchor:"right",x:1}};Plotly.newPlot(x,u,n,{responsive:!0}),window.dispatchEvent(new Event("resize"))}async function m(){p("buffett");try{const a=await w([g,_]),t=v(a);b(t),y.hidden=!1,f.textContent="Buffett indicator dataset loaded."}catch(a){console.error(a),f.textContent=`Failed to load dataset: ${a.message}`,f.style.color="#dc2626"}}document.readyState==="complete"?m():window.addEventListener("load",m,{once:!0});
