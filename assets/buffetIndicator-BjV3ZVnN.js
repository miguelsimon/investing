import{i as y}from"./navigation-CXrC8Ner.js";import{r as x}from"./markdown-BYZln54M.js";const m=document.getElementById("buffet-description-content"),f=document.getElementById("status"),g=document.getElementById("buffet-chart-section"),w=document.getElementById("buffet-chart"),_="calculated_data/us_gdp_and_market_cap.csv",b="us_gdp_and_market_cap.csv";async function v(){try{const e=await fetch("buffet_indicator.md",{headers:{Accept:"text/plain"}});if(!e.ok)throw new Error(`Failed to load buffet_indicator.md (${e.status})`);const t=await e.text();m.innerHTML=x(t)}catch(e){m.textContent="Visualize GDP versus market capitalization and track the Buffett indicator through time.",console.error("Failed to load buffet_indicator.md",e)}}async function E(e){let t=null;for(const r of e)try{const i=await fetch(r,{headers:{Accept:"text/csv"}});if(!i.ok){t=new Error(`Failed to load ${r}: ${i.status}`);continue}return await i.text()}catch(i){t=i}throw t??new Error("Unable to load Buffett indicator dataset.")}function k(e){const t=(e??"").trim();if(!t)return[];const r=t.split(/\r?\n/).filter(o=>o.trim().length>0);if(r.length===0)return[];const i=r[0].split(",").map(o=>o.trim());function d(o){const n=[];let a="",c=!1;for(let s=0;s<o.length;s+=1){const l=o[s];l==='"'?c&&o[s+1]==='"'?(a+='"',s+=1):c=!c:l===","&&!c?(n.push(a),a=""):a+=l}return n.push(a),n}const u=[];for(let o=1;o<r.length;o+=1){const n=d(r[o]);if(n.length===1&&n[0].trim()==="")continue;const a={};i.forEach((c,s)=>{const l=n[s]??"";a[c]=l.trim()}),u.push(a)}return u}function h(e){const t=Number(e);return Number.isFinite(t)?t:null}function C(e){const t=[],r=[],i=[],d=[];if(e.forEach(n=>{const a=n.time??n.Time??n.TIME,c=h(n.gdp_constant_2017_usd),s=h(n.market_cap_2017_usd),l=h(n.buffet_indicator);!a||c===null||s===null||l===null||(t.push(a),r.push(c),i.push(s),d.push(l))}),t.length===0)throw new Error("Dataset did not contain any usable rows.");const u=[{name:"Buffett Indicator",x:t,y:d,type:"scatter",mode:"lines",line:{color:"#0ea5e9",width:2},yaxis:"y",hovertemplate:"%{x}<br>Indicator: %{y:.2f}<extra></extra>"},{name:"Market Cap (2017 USD)",x:t,y:i,type:"scatter",mode:"lines",line:{color:"#f97316",width:2,dash:"dash"},opacity:.7,yaxis:"y2",hovertemplate:"%{x}<br>Market Cap: %{y:$,.0f}<extra></extra>"},{name:"GDP (2017 USD)",x:t,y:r,type:"scatter",mode:"lines",line:{color:"#22c55e",width:2,dash:"dot"},opacity:.7,yaxis:"y2",hovertemplate:"%{x}<br>GDP: %{y:$,.0f}<extra></extra>"}],o={margin:{t:32,r:40,b:40,l:60},hovermode:"x unified",xaxis:{title:"Month",type:"date",showgrid:!1},yaxis:{title:"Buffett Indicator (Market Cap / GDP)",rangemode:"tozero",tickformat:".2f"},yaxis2:{title:"Chained 2017 USD",overlaying:"y",side:"right",tickformat:"$,.0f",showgrid:!1},legend:{orientation:"h",yanchor:"bottom",y:1.02,xanchor:"right",x:1}};Plotly.newPlot(w,u,o,{responsive:!0}),window.dispatchEvent(new Event("resize"))}async function p(){y("buffett"),await v();try{const e=await E([_,b]),t=k(e);C(t),g.hidden=!1,f.textContent="Buffett indicator dataset loaded."}catch(e){console.error(e),f.textContent=`Failed to load dataset: ${e.message}`,f.style.color="#dc2626"}}document.readyState==="complete"?p():window.addEventListener("load",p,{once:!0});
