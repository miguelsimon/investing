const D="calculated_data/problem.json";function j(){return typeof window>"u"||!window.location?D:new URL(D,window.location.href).toString()}async function I(e){const t=j(),n=await fetch(t,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`Failed to load problem: ${n.status}`);return n.json()}function R(e){if(!e||typeof e!="object")return[];const t=e.price_in_constant_usd;return!t||typeof t!="object"?[]:Object.keys(t).sort()}function L(e){if(!e||typeof e!="object")return{};const t=e.symbol_descriptions;return!t||typeof t!="object"?{}:{...t}}function _(e){return typeof e=="number"&&Number.isFinite(e)}function U(e,t){const n=Array.isArray(e==null?void 0:e.days)?e.days:[];if(!Array.isArray(t)||t.length===0||n.length===0)return null;const r=(e==null?void 0:e.price_in_constant_usd)??{};let o=0,a=n.length-1;for(const c of t){const l=Array.isArray(r[c])?r[c]:null;if(!l||l.length!==n.length)return null;let u=-1,y=-1;for(let s=0;s<l.length;s+=1)if(_(l[s])){u=s;break}for(let s=l.length-1;s>=0;s-=1)if(_(l[s])){y=s;break}if(u===-1||y===-1||u>y)return null;for(let s=u;s<=y;s+=1)if(!_(l[s]))return null;if(o=Math.max(o,u),a=Math.min(a,y),o>a)return null}return{startIndex:o,endIndex:a}}function z(e,t){var o;const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=Array.isArray((o=e==null?void 0:e.price_in_constant_usd)==null?void 0:o[t])?e.price_in_constant_usd[t]:null;if(!r||r.length!==n.length)return null;for(let a=0;a<r.length;a+=1)if(_(r[a]))return n[a];return null}function v(e,t){if(!Array.isArray(e))return[];const n=new Set(t),r=[],o=new Set;return e.forEach(a=>{!n.has(a)||o.has(a)||(r.push(a),o.add(a))}),r}function B(e,t={}){const{selectedTickers:n,onSelectionChange:r}=t,o=R(e),a=L(e);if(o.length===0){const i=document.createElement("p");return i.textContent="No tickers available.",i}const c=document.createElement("table");c.className="ticker-table",c.style.marginTop="12px",c.style.borderCollapse="collapse",c.style.minWidth="480px",c.style.maxWidth="960px",c.style.border="1px solid #cbd5e1";const l=document.createElement("tr");["Selected","Ticker","Description","Data since"].forEach((i,h)=>{const d=document.createElement("th");d.scope="col",d.textContent=i,d.style.textAlign="left",d.style.padding="6px 10px",d.style.borderBottom="1px solid #cbd5e1",d.style.borderRight=h<3?"1px solid #cbd5e1":"none",d.style.whiteSpace="nowrap",l.appendChild(d)});const u=document.createElement("thead");u.appendChild(l),c.appendChild(u);const y=document.createElement("tbody"),s=o.map(i=>({ticker:i,description:a[i],dataSince:z(e,i)})).sort((i,h)=>{const d=i.dataSince??"",C=h.dataSince??"";return!d&&!C?i.ticker.localeCompare(h.ticker):d?C?d===C?i.ticker.localeCompare(h.ticker):d.localeCompare(C):-1:1}),p=s.map(i=>i.ticker),S=v(n,p),w=S.length>0?S:[...p],f=new Set(w);console.debug("[problemView] initial selection",w);const N=()=>{typeof r=="function"&&r(Array.from(f))},M=[],P=i=>{f.clear(),s.forEach((h,d)=>{d<=i&&f.add(h.ticker)}),M.forEach((h,d)=>{h.checked=d<=i}),N()};return s.forEach(({ticker:i,description:h,dataSince:d},C)=>{const T=document.createElement("tr"),E=document.createElement("td");E.style.padding="6px 10px",E.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",E.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",E.style.textAlign="center";const g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.gap="0.35rem";const m=document.createElement("input");m.type="checkbox",m.checked=f.has(i),m.dataset.ticker=i,M.push(m),m.addEventListener("change",()=>{m.checked?f.add(i):f.delete(i),console.debug("[problemView] checkbox toggled",{ticker:i,checked:m.checked,selection:Array.from(f)}),N()}),g.appendChild(m);const x=document.createElement("button");x.type="button",x.textContent="Select up to",x.style.fontSize="0.75rem",x.style.padding="2px 6px",x.style.whiteSpace="nowrap",x.addEventListener("click",()=>{P(C)}),g.appendChild(x),E.appendChild(g),T.appendChild(E);const A=document.createElement("td");A.textContent=i,A.style.padding="6px 10px",A.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",A.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",A.style.textAlign="left",T.appendChild(A);const b=document.createElement("td");b.textContent=typeof h=="string"&&h.trim()?h.trim():"—",b.style.padding="6px 10px",b.style.borderRight="1px solid rgba(148, 163, 184, 0.6)",b.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",b.style.textAlign="left",T.appendChild(b);const k=document.createElement("td");k.textContent=d??"—",k.style.padding="6px 10px",k.style.borderBottom="1px solid rgba(148, 163, 184, 0.6)",k.style.textAlign="left",k.style.whiteSpace="nowrap",T.appendChild(k),y.appendChild(T)}),c.appendChild(y),c}function G(e,t,n={}){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const{onSelectionChange:r,selectedTickers:o}=n;if(e.innerHTML="",!t)return e.appendChild(document.createTextNode("No problem data available.")),e;const a=document.createElement("h2");a.textContent="Problem Overview";const c=document.createElement("ul"),l=document.createElement("li"),u=Array.isArray(t.days)?t.days.length:0;l.textContent=`Days covered: ${u}`;const y=document.createElement("li");y.textContent=`Constant USD day: ${t.constant_usd_day??"n/a"}`;const s=document.createElement("li");s.textContent=`Constant EUR day: ${t.constant_eur_day??"n/a"}`,c.append(l,y,s),e.append(a,c);const p=B(t,{selectedTickers:o,onSelectionChange:r});return e.appendChild(p),e}function F(e){if(!Array.isArray(e)||e.length===0)return[];const t=Number(e[0]);return!Number.isFinite(t)||t===0?e.map(()=>Number.NaN):e.map(n=>{const r=Number(n);return Number.isFinite(r)?r/t:Number.NaN})}function H(e,t={}){const n=Array.isArray(e==null?void 0:e.days)?e.days:[],r=(e==null?void 0:e.price_in_constant_usd)??{},o=Array.isArray(t.tickers)&&t.tickers.length>0?t.tickers:R(e);if(!n.length||!o.length)return[];const a=Math.max(0,Math.min(t.startIndex??0,n.length-1)),c=Math.max(a,Math.min(t.endIndex??n.length-1,n.length-1)),l=n.slice(a,c+1),u=L(e),y=[];for(const s of o){const p=Array.isArray(r[s])?r[s]:[];if(p.length===0||n.length!==p.length)continue;const S=p.slice(a,c+1);if(S.some(N=>!_(N)))continue;const w=u[s],f=typeof w=="string"&&w.trim()?`${s}: ${w.trim()}`:s;y.push({name:s,x:l,y:F(S),type:"scatter",mode:"lines",hovertemplate:"<b>%{x}</b><br />growth: %{y:.2f}x<extra>"+f+"</extra>"})}return y}function $(e,t){var r;if(!e||!((r=t==null?void 0:t.Plots)!=null&&r.resize))return;const n=()=>{try{t.Plots.resize(e)}catch{}};typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,0)}function V(e,t,n={},r=globalThis.Plotly){if(!(e instanceof HTMLElement))throw new TypeError("container must be an HTMLElement");const o=H(t,n);if(!r||o.length===0){e.innerHTML="";const u=typeof n.emptyMessage=="string"&&n.emptyMessage.trim()?n.emptyMessage.trim():"Chart unavailable.";return e.append(document.createTextNode(u)),null}const a={title:"$1 Constant-Dollar Growth",yaxis:{title:"Growth factor (x)",rangemode:"tozero"},xaxis:{title:"Date"},legend:{orientation:"v",x:1.02,xanchor:"left",y:1,valign:"top"},margin:{t:50,r:160,b:50,l:50}},c={responsive:!0},l=r.react(e,o,a,c);return $(e,r),l}export{U as a,G as b,L as c,B as d,I as f,R as g,V as r};
